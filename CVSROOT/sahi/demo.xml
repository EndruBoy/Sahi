<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="demo" default="sahitests">
	<taskdef name="sahi" classname="com.sahi.ant.RunSahiTask" classpath="lib/ant-sahi.jar"/>

	<target name="sahitests" description="start the server and run sahi tests">
		<parallel>
			<sequential>
				<waitfor maxwait="3" maxwaitunit="minute" checkevery="100">
					<http url="http://localhost:10000/demo/index.htm"/>
				</waitfor>
				<sahi suite="../scripts/demo.suite"
					browser="C:\\Program Files\\Internet Explorer\\iexplore.exe"
					baseurl="http://localhost:10000/demo/"
					sahihost="localhost"
					sahiport="9999"
					failureproperty="sahi.failed"
					haltonfailure="false"
					threads="2"
					/>
				<antcall target="stop-web"/>
				<antcall target="failsahi"/>
			</sequential>
			<antcall target="start-web"/>
		</parallel>
	</target>	

	<target name="failsahi" if="sahi.failed">
		<fail message="Sahi tests failed!"/>
	</target>

	<target name="start-web" description="starts web">
        <java classname="com.sahi.WebServer" fork="true" dir="bin"
            jvmargs="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5006" >
            <classpath path="classes"/>
        </java>
    </target>

	<target name="stop-web" description="stop web server">
		<get dest="stopserver.htm" src="http://localhost:10000/dyn/stopserver" ignoreerrors="true" />
		<delete file="stopserver.htm"/>
	</target>	
	

	<target name="sahireport" description="show report">	
		<exec command="C:\\Program Files\\Internet Explorer\\iexplore.exe http://localhost:9999/_s_/spr/logs/"/>
    </target>
</project>